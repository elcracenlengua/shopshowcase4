<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Checkout - Dark Purple Theme</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e6e6ff;
            overflow-x: hidden;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        /* Animated background waves */
        .waves {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
        }

        .wave {
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 40%;
            animation: wave 20s infinite linear;
        }

        .wave:nth-child(2) {
            animation-delay: -5s;
            background: linear-gradient(45deg, rgba(118, 75, 162, 0.1), rgba(102, 126, 234, 0.1));
        }

        @keyframes wave {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
        }

        .header {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            color: white;
            padding: 60px 20px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 10;
        }

        .back-button:hover {
            transform: scale(1.1) rotate(-5deg);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .typing-text {
            font-size: 16px;
            opacity: 0.8;
            margin-top: 8px;
        }

        .checkout-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #e6e6ff;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #e6e6ff;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-input::placeholder {
            color: rgba(230, 230, 255, 0.5);
        }

        .order-summary {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: 700;
            color: #667eea;
            font-size: 18px;
            margin-top: 8px;
            padding-top: 16px;
            border-top: 2px solid rgba(102, 126, 234, 0.3);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .payment-method {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }

        .payment-method:hover {
            border-color: rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        .payment-method.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .payment-method i {
            font-size: 24px;
            margin-bottom: 8px;
            color: #667eea;
        }

        .submit-order-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 18px 32px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            position: relative;
            overflow: hidden;
            margin-top: 20px;
        }

        .submit-order-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .submit-order-btn:hover::before {
            left: 100%;
        }

        .submit-order-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }

        .submit-order-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 40px;
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 16px;
            margin-top: 20px;
        }

        .success-message i {
            font-size: 64px;
            color: #2ecc71;
            margin-bottom: 20px;
        }

        .error-message {
            display: none;
            color: #ff4757;
            font-size: 14px;
            margin-top: 8px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
            }
            
            .checkout-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="waves">
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <div class="back-button" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
            </div>
            <h1>Secure Checkout</h1>
            <div class="typing-text" id="typing-text"></div>
        </div>

        <div class="checkout-content">
            <form id="checkout-form" onsubmit="submitOrder(event)">
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-user"></i>
                        Personal Information
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name *</label>
                            <input type="text" class="form-input" name="firstName" required placeholder="John">
                            <div class="error-message" id="firstName-error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name *</label>
                            <input type="text" class="form-input" name="lastName" required placeholder="Doe">
                            <div class="error-message" id="lastName-error"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-input" name="email" required placeholder="john@example.com">
                        <div class="error-message" id="email-error"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" name="phone" placeholder="+1 (555) 123-4567">
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Shipping Address
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address *</label>
                        <input type="text" class="form-input" name="address" required placeholder="123 Main Street">
                        <div class="error-message" id="address-error"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">City *</label>
                            <input type="text" class="form-input" name="city" required placeholder="New York">
                            <div class="error-message" id="city-error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ZIP Code *</label>
                            <input type="text" class="form-input" name="zipCode" required placeholder="10001">
                            <div class="error-message" id="zipCode-error"></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-credit-card"></i>
                        Payment Method
                    </div>
                    <div class="payment-methods">
                        <div class="payment-method selected" onclick="selectPaymentMethod(this, 'card')">
                            <i class="fas fa-credit-card"></i>
                            <div>Credit Card</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'paypal')">
                            <i class="fab fa-paypal"></i>
                            <div>PayPal</div>
                        </div>
                    </div>
                    <input type="hidden" name="paymentMethod" value="card">
                </div>

                <div class="order-summary">
                    <div class="section-title">
                        <i class="fas fa-receipt"></i>
                        Order Summary
                    </div>
                    <div id="order-items">
                        <!-- Order items will be dynamically inserted here -->
                    </div>
                </div>

                <button type="submit" class="submit-order-btn" id="submit-btn">
                    <i class="fas fa-lock"></i> Place Order Securely
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <h3>Processing your order...</h3>
                <p>Please wait while we secure your payment.</p>
            </div>

            <div class="success-message" id="success-message">
                <i class="fas fa-check-circle"></i>
                <h3>Order Placed Successfully!</h3>
                <p>Thank you for your purchase. You will receive a confirmation email shortly.</p>
                <p>Order Number: <strong id="order-number"></strong></p>
                <button class="submit-order-btn" onclick="goBackToShop()" style="margin-top: 20px; max-width: 200px;">
                    Continue Shopping
                </button>
            </div>
        </div>
    </div>

    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let selectedPaymentMethod = 'card';

        // Initialize typing effect
        function initTyping() {
            const typed = new Typed('#typing-text', {
                strings: [
                    'Secure payment processing',
                    'Your data is encrypted',
                    'Fast order fulfillment',
                    'Almost there...'
                ],
                typeSpeed: 50,
                backSpeed: 30,
                backDelay: 2000,
                loop: true,
                showCursor: true,
                cursorChar: '|'
            });
        }

        function renderOrderSummary() {
            const orderItemsContainer = document.getElementById('order-items');
            
            if (cart.length === 0) {
                orderItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
                return;
            }

            let subtotal = 0;
            const itemsHtml = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                return `
                    <div class="summary-item">
                        <span>${item.name} × ${item.quantity}</span>
                        <span>$${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            }).join('');

            const shipping = subtotal > 0 ? 5.99 : 0;
            const total = subtotal + shipping;

            orderItemsContainer.innerHTML = itemsHtml + `
                <div class="summary-item">
                    <span>Subtotal</span>
                    <span>$${subtotal.toFixed(2)}</span>
                </div>
                <div class="summary-item">
                    <span>Shipping</span>
                    <span>${shipping > 0 ? `$${shipping.toFixed(2)}` : 'Free'}</span>
                </div>
                <div class="summary-item">
                    <span>Total</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `;
        }

        function selectPaymentMethod(element, method) {
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedPaymentMethod = method;
            document.querySelector('input[name="paymentMethod"]').value = method;

            // Animate selection
            anime({
                targets: element,
                scale: [1, 1.05, 1],
                duration: 300,
                easing: 'easeOutCubic'
            });
        }

        function validateForm() {
            let isValid = true;
            const requiredFields = ['firstName', 'lastName', 'email', 'address', 'city', 'zipCode'];
            
            requiredFields.forEach(field => {
                const input = document.querySelector(`input[name="${field}"]`);
                const errorElement = document.getElementById(`${field}-error`);
                
                if (!input.value.trim()) {
                    errorElement.textContent = 'This field is required';
                    errorElement.style.display = 'block';
                    isValid = false;
                } else {
                    errorElement.style.display = 'none';
                }
            });

            // Email validation
            const email = document.querySelector('input[name="email"]').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address';
                document.getElementById('email-error').style.display = 'block';
                isValid = false;
            }

            return isValid;
        }

        async function submitOrder(event) {
            event.preventDefault();
            
            if (!validateForm()) {
                return;
            }

            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }

            const formData = new FormData(event.target);
            const orderData = {
                orderId: 'ORD-' + Date.now(),
                timestamp: new Date().toISOString(),
                items: cart,
                subtotal: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                shipping: 5.99,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) + 5.99,
                customer: {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    city: formData.get('city'),
                    zipCode: formData.get('zipCode')
                },
                paymentMethod: selectedPaymentMethod,
                status: 'pending'
            };

            // Show loading
            document.getElementById('checkout-form').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 3000));

                // Save order to localStorage (in real app, this would be sent to server)
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                orders.push(orderData);
                localStorage.setItem('orders', JSON.stringify(orders));

                // Clear cart
                localStorage.removeItem('cart');

                // Show success message
                document.getElementById('loading').style.display = 'none';
                document.getElementById('success-message').style.display = 'block';
                document.getElementById('order-number').textContent = orderData.orderId;

                // Animate success message
                anime({
                    targets: '#success-message',
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    duration: 600,
                    easing: 'easeOutCubic'
                });

                // Send notification to bot owner (simulated)
                await notifyOwner(orderData);

            } catch (error) {
                console.error('Order submission failed:', error);
                alert('Failed to submit order. Please try again.');
                document.getElementById('checkout-form').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        async function notifyOwner(orderData) {
            // In a real implementation, this would send a request to your backend
            // which would then notify the bot owner via Telegram
            console.log('New order placed:', orderData);
            
            // Simulate API call to notify owner
            try {
                if (cart.length === 0) return;
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                // Send data to bot
                tg.sendData(JSON.stringify(orderData));
                // Clear cart
                cart = [];
            } catch (error) {
                console.error('Failed to notify owner:', error);
            }
        }

        function goBack() {
            window.location.href = 'cart.html';
        }

        function goBackToShop() {
            window.location.href = 'index.html';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initTyping();
            renderOrderSummary();

            // Animate form sections
            anime({
                targets: '.form-section, .order-summary',
                translateY: [50, 0],
                opacity: [0, 1],
                delay: anime.stagger(100),
                duration: 600,
                easing: 'easeOutCubic'
            });

            // Animate header
            anime({
                targets: '.header',
                translateY: [-50, 0],
                opacity: [0, 1],
                duration: 800,
                easing: 'easeOutCubic'
            });

            // Add input focus animations
            document.querySelectorAll('.form-input').forEach(input => {
                input.addEventListener('focus', function() {
                    anime({
                        targets: this,
                        scale: [1, 1.02, 1],
                        duration: 300,
                        easing: 'easeOutCubic'
                    });
                });
            });
        });

        // Real-time form validation
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('blur', function() {
                if (this.hasAttribute('required') && !this.value.trim()) {
                    const errorElement = document.getElementById(this.name + '-error');
                    if (errorElement) {
                        errorElement.textContent = 'This field is required';
                        errorElement.style.display = 'block';
                    }
                }
            });

            input.addEventListener('input', function() {
                const errorElement = document.getElementById(this.name + '-error');
                if (errorElement && this.value.trim()) {
                    errorElement.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
